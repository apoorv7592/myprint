!function(t){function e(t){var e;for(e=0;e<i.length;e++)i[e]!=t&&i[e].hide()}function a(e,a){this.$el=t(e),this.proxy("show").proxy("ahead").proxy("hide").proxy("keyHandler").proxy("selectDate");var a=t.extend({},t.fn.datepicker.defaults,a);(a.parse||a.format||!this.detectNative())&&(t.extend(this,a),this.$el.data("datepicker",this),i.push(this),this.init())}var s="[data-datepicker]",i=[];a.prototype={detectNative:function(){if(navigator.userAgent.match(/(iPad|iPhone); CPU(\ iPhone)? OS 5_\d/i)){var e=t("<span>").insertBefore(this.$el);return this.$el.detach().attr("type","date").insertAfter(e),e.remove(),!0}return!1},init:function(){var e=this.nav("months",1),a=this.nav("years",12),s=t("<div>").addClass("nav").append(e,a);this.$month=t(".name",e),this.$year=t(".name",a),$calendar=t("<div>").addClass("calendar");for(var i=0;i<this.shortDayNames.length;i++)$calendar.append('<div class="dow">'+this.shortDayNames[(i+this.startOfWeek)%7]+"</div>");this.$days=t("<div>").addClass("days"),$calendar.append(this.$days),this.$picker=t("<div>").click(function(t){t.stopPropagation()}).mousedown(function(t){t.preventDefault()}).addClass("datepicker").append(s,$calendar).insertAfter(this.$el),this.$el.focus(this.show).click(this.show).change(t.proxy(function(){this.selectDate()},this)),this.selectDate(),this.hide()},nav:function(e,a){var s=t('<div><span class="prev button">&larr;</span><span class="name"></span><span class="next button">&rarr;</span></div>').addClass(e);return t(".prev",s).click(t.proxy(function(){this.ahead(-a,0)},this)),t(".next",s).click(t.proxy(function(){this.ahead(a,0)},this)),s},updateName:function(e,a){var s=e.find(".fg").text(),i=t("<div>").addClass("fg").append(a);if(e.empty(),s!=a){var n=t("<div>").addClass("bg");e.append(n,i),n.fadeOut("slow",function(){t(this).remove()})}else e.append(i)},selectMonth:function(e){var a=new Date(e.getFullYear(),e.getMonth(),1);if(!this.curMonth||this.curMonth.getFullYear()!=a.getFullYear()||this.curMonth.getMonth()!=a.getMonth()){this.curMonth=a;var s=this.rangeStart(e),i=this.rangeEnd(e),n=this.daysBetween(s,i);this.$days.empty();for(var r=0;n>=r;r++){var h=new Date(s.getFullYear(),s.getMonth(),s.getDate()+r,12,0),d=t("<div>").attr("date",this.format(h));d.text(h.getDate()),h.getMonth()!=e.getMonth()&&d.addClass("overlap"),this.$days.append(d)}this.updateName(this.$month,this.monthNames[e.getMonth()]),this.updateName(this.$year,this.curMonth.getFullYear()),t("div",this.$days).click(t.proxy(function(e){var a=t(e.target);this.update(a.get(0).getAttribute("date")),a.hasClass("overlap")||this.hide()},this)),t("[date='"+this.format(new Date)+"']",this.$days).addClass("today")}t(".selected",this.$days).removeClass("selected"),t('[date="'+this.selectedDateStr+'"]',this.$days).addClass("selected")},selectDate:function(t){"undefined"==typeof t&&(t=this.parse(this.$el.val())),t||(t=new Date),this.selectedDate=t,this.selectedDateStr=this.format(this.selectedDate),this.selectMonth(this.selectedDate)},update:function(t){this.$el.val(t).change()},show:function(a){a&&a.stopPropagation(),e(this);var s=this.$el.offset();this.$picker.css({top:s.top+this.$el.outerHeight()+2,left:s.left}).show(),t("html").on("keydown",this.keyHandler)},hide:function(){this.$picker.hide(),t("html").off("keydown",this.keyHandler)},keyHandler:function(t){switch(t.keyCode){case 9:case 27:return void this.hide();case 13:this.update(this.selectedDateStr),this.hide();break;case 38:this.ahead(0,-7);break;case 40:this.ahead(0,7);break;case 37:this.ahead(0,-1);break;case 39:this.ahead(0,1);break;default:return}t.preventDefault()},parse:function(t){var e;return(e=t.match(/^(\d{4,4})-(\d{2,2})-(\d{2,2})$/))?new Date(e[1],e[2]-1,e[3]):null},format:function(t){var e=(t.getMonth()+1).toString(),a=t.getDate().toString();return 1===e.length&&(e="0"+e),1===a.length&&(a="0"+a),t.getFullYear()+"-"+e+"-"+a},ahead:function(t,e){this.selectDate(new Date(this.selectedDate.getFullYear(),this.selectedDate.getMonth()+t,this.selectedDate.getDate()+e))},proxy:function(e){return this[e]=t.proxy(this[e],this),this},daysBetween:function(t,e){var t=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate()),e=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate());return(e-t)/864e5},findClosest:function(t,e,a){var s=a*(Math.abs(e.getDay()-t-7*a)%7);return new Date(e.getFullYear(),e.getMonth(),e.getDate()+s)},rangeStart:function(t){return this.findClosest(this.startOfWeek,new Date(t.getFullYear(),t.getMonth()),-1)},rangeEnd:function(t){return this.findClosest((this.startOfWeek-1)%7,new Date(t.getFullYear(),t.getMonth()+1,0),1)}},t.fn.datepicker=function(t){return this.each(function(){new a(this,t)})},t(function(){t(s).datepicker(),t("html").click(e)}),t.fn.datepicker.DatePicker=a,t.fn.datepicker.defaults={monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],shortDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],startOfWeek:1}}(window.jQuery||window.ender);